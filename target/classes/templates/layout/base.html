<!DOCTYPE html>
<html
  lang="en"
  xmlns:th="http://www.thymeleaf.org"
  xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
  th:fragment="page(title, content)"
>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title th:text="${title} + ' | Huaxia Atlas'">Huaxia Atlas</title>

    <!-- Bootstrap 5 -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link rel="stylesheet" th:href="@{/css/app.css}" />
  </head>

  <body>
    <nav class="navbar navbar-expand-lg px-2">
      <div class="container">
        <a class="navbar-brand fw-semibold d-flex align-items-center gap-2" th:href="@{/}">
          <span class="hx-chip small">Atlas</span>
          Huaxia Atlas
        </a>
        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navMain"
        >
          <span class="navbar-toggler-icon"></span>
        </button>

        <div id="navMain" class="collapse navbar-collapse">
          <ul class="navbar-nav me-auto">
            <li class="nav-item" data-bs-toggle="tooltip" title="Browse curated works">
              <a class="nav-link" th:href="@{/explore}">Explore</a>
            </li>
            <li class="nav-item" data-bs-toggle="tooltip" title="Search with AI context">
              <a class="nav-link" th:href="@{/search}">AI Search</a>
            </li>
            <li class="nav-item" data-bs-toggle="tooltip" title="Chat with the Atlas assistant">
              <a class="nav-link" th:href="@{/chat}">AI Chat</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" th:href="@{/posts}">Posts</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" th:href="@{/products}">Products</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" th:href="@{/contact}">Contact</a>
            </li>
            <li class="nav-item" sec:authorize="hasRole('ADMIN')">
              <a class="nav-link" th:href="@{/admin/dashboard}">Dashboard</a>
            </li>
          </ul>

          <div class="d-flex gap-2 align-items-center" sec:authorize="!isAuthenticated()">
            <a
              class="btn btn-outline-secondary btn-sm"
              th:href="@{/login}"
              >Login</a
            >
          </div>

          <div class="d-flex gap-2 align-items-center" sec:authorize="isAuthenticated()">
            <span class="small text-muted">Hi, <span sec:authentication="name"></span></span>
            <form th:action="@{/logout}" method="post" class="d-inline">
              <input
                type="hidden"
                th:name="${_csrf.parameterName}"
                th:value="${_csrf.token}"
              />
              <button class="btn btn-outline-secondary btn-sm">Logout</button>
            </form>
          </div>
        </div>
      </div>
    </nav>

    <main class="container py-4">
      <div
        th:if="${success}"
        class="alert alert-success d-none"
        data-toast="success"
        th:text="${success}"
      ></div>
      <div
        th:if="${error}"
        class="alert alert-danger d-none"
        data-toast="error"
        th:text="${error}"
      ></div>

      <div th:replace="${content}"></div>
    </main>

    <footer class="footer py-4">
      <div class="container">
        <div class="row g-3">
          <div class="col-md-4">
            <h6 class="text-white">Huaxia Atlas</h6>
            <p class="mb-2">
              Discover ancient Chinese architecture with curated context,
              intelligent search, and an AI guide.
            </p>
            <div class="small text-muted">Spring Boot - MySQL - AI services</div>
          </div>
          <div class="col-md-4">
            <h6 class="text-white">Navigation</h6>
            <div class="d-flex flex-column gap-1">
              <a th:href="@{/explore}">Explore collection</a>
              <a th:href="@{/posts}">Community posts</a>
              <a th:href="@{/products}">Products</a>
              <a th:href="@{/contact}">Contact</a>
              <a th:href="@{/login}" sec:authorize="!isAuthenticated()">Login</a>
              <a th:href="@{/admin/dashboard}" sec:authorize="hasRole('ADMIN')">Dashboard</a>
            </div>
          </div>
          <div class="col-md-4">
            <h6 class="text-white">Stay connected</h6>
            <p class="mb-1">Get updates on new buildings and features.</p>
            <div class="d-flex flex-wrap gap-2">
              <span class="hx-chip">WeChat</span>
              <span class="hx-chip">Email</span>
              <span class="hx-chip">Research</span>
            </div>
            <div class="small text-muted mt-2">
              Copyright <span th:text="${#dates.format(#dates.createNow(), 'yyyy')}"></span> Huaxia Atlas
            </div>
          </div>
        </div>
      </div>
    </footer>

    <!-- Toasts -->
    <div id="hx-toast-stack" class="hx-toast-stack"></div>

    <!-- Info modal -->
    <div
      class="modal fade"
      id="hxInfoModal"
      tabindex="-1"
      aria-labelledby="hxInfoModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content bg-dark text-white border-0">
          <div class="modal-header border-0">
            <h5 class="modal-title" id="hxInfoModalLabel">
              How we curate Huaxia Atlas
            </h5>
            <button
              type="button"
              class="btn-close btn-close-white"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body">
            We combine trusted references, teacher-reviewed seed data, AI search,
            and suggestions from the ML service to surface historically accurate
            entries before they reach the public catalog.
          </div>
          <div class="modal-footer border-0">
            <button
              type="button"
              class="btn btn-outline-secondary"
              data-bs-dismiss="modal"
            >
              Close
            </button>
            <a class="btn btn-dark" th:href="@{/explore}">Explore collection</a>
          </div>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script th:src="@{/js/app.js}"></script>
  </body>
</html>
