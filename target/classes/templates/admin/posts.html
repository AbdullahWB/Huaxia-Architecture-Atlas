<!DOCTYPE html>
<html
  lang="en"
  xmlns:th="http://www.thymeleaf.org"
  th:replace="layout/base :: page('Posts', ~{::section})"
>
  <section class="hx-section">
    <div class="d-flex align-items-center justify-content-between mb-3 flex-wrap gap-2">
      <div>
        <div class="hx-breadcrumb mb-2">Admin <span>Posts</span></div>
        <h1 class="h4 mb-1">Community posts</h1>
        <p class="text-muted mb-0">Review submissions and keep the archive accurate.</p>
      </div>
      <a class="btn btn-outline-secondary btn-sm" th:href="@{/posts}">View public posts</a>
    </div>

    <div class="btn-group" role="group" aria-label="Post status filter">
      <a
        class="btn btn-outline-dark"
        th:classappend="${status.name() == 'PENDING'} ? 'active'"
        th:href="@{/admin/posts(status='PENDING')}"
        >Pending</a
      >
      <a
        class="btn btn-outline-dark"
        th:classappend="${status.name() == 'APPROVED'} ? 'active'"
        th:href="@{/admin/posts(status='APPROVED')}"
        >Approved</a
      >
      <a
        class="btn btn-outline-dark"
        th:classappend="${status.name() == 'REJECTED'} ? 'active'"
        th:href="@{/admin/posts(status='REJECTED')}"
        >Rejected</a
      >
    </div>

    <div class="hx-card mt-3">
      <div class="table-responsive">
        <table class="table table-hover align-middle mb-0">
          <thead class="table-light">
            <tr>
              <th style="width: 70px">ID</th>
              <th>Post</th>
              <th style="width: 150px">Status</th>
              <th style="width: 220px" class="text-end">Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr th:each="p : ${items}">
              <td th:text="${p.id}">1</td>
              <td>
                <div class="fw-semibold" th:text="${p.title}">Title</div>
                <div class="small text-muted" th:text="${#strings.abbreviate(p.content, 140)}">
                  Excerpt
                </div>
                <div class="small text-muted">
                  <span th:text="${p.authorName} ?: 'Anonymous'">Anonymous</span>
                  <span th:if="${p.authorEmail}" th:text="' | ' + ${p.authorEmail}">| email</span>
                </div>
              </td>
              <td>
                <span class="badge text-bg-light border" th:text="${p.status}">PENDING</span>
                <div
                  class="small text-muted"
                  th:if="${p.createdAt != null}"
                  th:text="${#temporals.format(p.createdAt, 'yyyy-MM-dd')}"
                >
                  2026-01-18
                </div>
              </td>
              <td class="text-end">
                <form
                  class="d-inline"
                  th:if="${p.status != null and p.status.name() != 'APPROVED'}"
                  th:action="@{/admin/posts/{id}/moderate(id=${p.id})}"
                  method="post"
                >
                  <input
                    type="hidden"
                    th:name="${_csrf.parameterName}"
                    th:value="${_csrf.token}"
                  />
                  <input type="hidden" name="status" value="APPROVED" />
                  <button class="btn btn-sm btn-outline-success">Approve</button>
                </form>
                <form
                  class="d-inline"
                  th:if="${p.status != null and p.status.name() != 'REJECTED'}"
                  th:action="@{/admin/posts/{id}/moderate(id=${p.id})}"
                  method="post"
                  onsubmit="return confirm('Reject this post?');"
                >
                  <input
                    type="hidden"
                    th:name="${_csrf.parameterName}"
                    th:value="${_csrf.token}"
                  />
                  <input type="hidden" name="status" value="REJECTED" />
                  <button class="btn btn-sm btn-outline-danger">Reject</button>
                </form>
              </td>
            </tr>

            <tr th:if="${items == null || #lists.isEmpty(items)}">
              <td colspan="4" class="text-center text-muted py-4">
                No posts found.
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <div
      class="d-flex justify-content-between align-items-center mt-3"
      th:if="${page != null and page.totalPages > 1}"
    >
      <a
        class="btn btn-outline-secondary btn-sm"
        th:classappend="${page.first} ? 'disabled'"
        th:href="@{/admin/posts(page=${page.number-1}, size=${page.size}, status=${status})}"
      >
        Prev
      </a>

      <div class="small text-muted">
        Page <span th:text="${page.number + 1}">1</span> /
        <span th:text="${page.totalPages}">1</span>
      </div>

      <a
        class="btn btn-outline-secondary btn-sm"
        th:classappend="${page.last} ? 'disabled'"
        th:href="@{/admin/posts(page=${page.number+1}, size=${page.size}, status=${status})}"
      >
        Next
      </a>
    </div>
  </section>
</html>
