<!DOCTYPE html>
<html
  lang="en"
  xmlns:th="http://www.thymeleaf.org"
  th:replace="layout/base :: page('Orders', ~{::section})"
>
  <section class="hx-section">
    <div class="d-flex align-items-center justify-content-between mb-3">
      <div>
        <div class="hx-breadcrumb mb-2">Admin <span>Orders</span></div>
        <h1 class="h4 mb-0">Orders</h1>
      </div>
    </div>

    <div class="hx-card">
      <div class="table-responsive">
        <table class="table table-hover align-middle mb-0">
          <thead class="table-light">
            <tr>
              <th style="width: 70px">ID</th>
              <th>User</th>
              <th>Product</th>
              <th style="width: 80px">Qty</th>
              <th style="width: 130px">Total</th>
              <th style="width: 130px">Status</th>
              <th style="width: 160px">Date</th>
              <th style="width: 240px" class="text-end">Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr th:each="o : ${items}">
              <td th:text="${o.id}">1</td>
              <td>
                <div class="fw-semibold" th:text="${o.user.username}">User</div>
                <div class="small text-muted" th:text="${o.user.email}">Email</div>
              </td>
              <td th:text="${o.product.name}">Product</td>
              <td th:text="${o.quantity}">1</td>
              <td th:text="'$' + ${#numbers.formatDecimal(o.totalPrice, 1, 2)}">$0.00</td>
              <td><span class="badge text-bg-light border" th:text="${o.status}">PENDING</span></td>
              <td th:text="${#temporals.format(o.createdAt, 'yyyy-MM-dd')}">2026-01-18</td>
              <td class="text-end">
                <form
                  class="d-inline"
                  th:action="@{/admin/orders/{id}/status(id=${o.id})}"
                  method="post"
                >
                  <input
                    type="hidden"
                    th:name="${_csrf.parameterName}"
                    th:value="${_csrf.token}"
                  />
                  <input type="hidden" name="status" value="COMPLETED" />
                  <button class="btn btn-sm btn-outline-success">Complete</button>
                </form>
                <form
                  class="d-inline"
                  th:action="@{/admin/orders/{id}/status(id=${o.id})}"
                  method="post"
                >
                  <input
                    type="hidden"
                    th:name="${_csrf.parameterName}"
                    th:value="${_csrf.token}"
                  />
                  <input type="hidden" name="status" value="CANCELLED" />
                  <button class="btn btn-sm btn-outline-danger">Cancel</button>
                </form>
              </td>
            </tr>

            <tr th:if="${items == null || #lists.isEmpty(items)}">
              <td colspan="8" class="text-center text-muted py-4">
                No orders found.
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <div
      class="d-flex justify-content-between align-items-center mt-3"
      th:if="${page != null and page.totalPages > 1}"
    >
      <a
        class="btn btn-outline-secondary btn-sm"
        th:classappend="${page.first} ? 'disabled'"
        th:href="@{/admin/orders(page=${page.number-1}, size=${page.size})}"
      >
        Prev
      </a>

      <div class="small text-muted">
        Page <span th:text="${page.number + 1}">1</span> /
        <span th:text="${page.totalPages}">1</span>
      </div>

      <a
        class="btn btn-outline-secondary btn-sm"
        th:classappend="${page.last} ? 'disabled'"
        th:href="@{/admin/orders(page=${page.number+1}, size=${page.size})}"
      >
        Next
      </a>
    </div>
  </section>
</html>
