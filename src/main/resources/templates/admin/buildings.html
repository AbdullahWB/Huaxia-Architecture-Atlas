<!DOCTYPE html>
<html
  lang="en"
  xmlns:th="http://www.thymeleaf.org"
  th:replace="layout/base :: page('Buildings', ~{::section})"
>
  <section class="hx-section">
    <div class="d-flex align-items-center justify-content-between mb-3 flex-wrap gap-2">
      <div>
        <div class="hx-breadcrumb mb-2">Admin <span>Buildings</span></div>
        <h1 class="h4 mb-0">Buildings</h1>
      </div>
      <div class="d-flex flex-wrap gap-2">
        <form th:action="@{/admin/logout}" method="post" class="d-inline">
          <input
            type="hidden"
            th:name="${_csrf.parameterName}"
            th:value="${_csrf.token}"
          />
          <button class="btn btn-outline-secondary btn-sm">Logout</button>
        </form>
        <a class="btn btn-dark btn-sm" th:href="@{/admin/buildings/new}">
          New Building
        </a>
      </div>
    </div>

    <div class="hx-card">
      <form
        class="row g-2 align-items-end"
        th:action="@{/admin/buildings}"
        method="get"
      >
        <div class="col-md-4">
          <label class="form-label">Type</label>
          <input
            class="form-control"
            name="type"
            placeholder="Type"
            th:value="${type}"
          />
        </div>
        <div class="col-md-4">
          <label class="form-label">Dynasty</label>
          <input
            class="form-control"
            name="dynasty"
            placeholder="Dynasty"
            th:value="${dynasty}"
          />
        </div>
        <div class="col-md-4 d-flex gap-2">
          <button class="btn btn-outline-dark w-100">Filter</button>
          <a class="btn btn-outline-secondary w-100" th:href="@{/admin/buildings}">
            Reset
          </a>
        </div>
      </form>
    </div>

    <div class="hx-card mt-3">
      <div class="table-responsive">
        <table class="table table-hover align-middle mb-0">
          <thead class="table-light">
            <tr>
              <th style="width: 70px">ID</th>
              <th>Name</th>
              <th>Dynasty</th>
              <th>Type</th>
              <th>Location</th>
              <th style="width: 220px" class="text-end">Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr th:each="b : ${items}">
              <td th:text="${b.id}">1</td>
              <td>
                <div class="fw-semibold" th:text="${b.name}">Name</div>
                <div class="small text-muted" th:text="${b.yearBuilt} ?: ''"></div>
              </td>
              <td th:text="${b.dynasty} ?: '-'">-</td>
              <td th:text="${b.type} ?: '-'">-</td>
              <td th:text="${b.location} ?: '-'">-</td>
              <td class="text-end">
                <a
                  class="btn btn-sm btn-outline-dark"
                  th:href="@{/admin/buildings/{id}/edit(id=${b.id})}"
                  >Edit</a
                >

                <form
                  class="d-inline"
                  th:action="@{/admin/buildings/{id}/delete(id=${b.id})}"
                  method="post"
                  onsubmit="return confirm('Delete this building?');"
                >
                  <input
                    type="hidden"
                    th:name="${_csrf.parameterName}"
                    th:value="${_csrf.token}"
                  />
                  <button class="btn btn-sm btn-outline-danger">Delete</button>
                </form>
              </td>
            </tr>

            <tr th:if="${items == null || #lists.isEmpty(items)}">
              <td colspan="6" class="text-center text-muted py-4">
                No buildings found.
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <div
      class="d-flex justify-content-between align-items-center mt-3"
      th:if="${page != null and page.totalPages > 1}"
    >
      <a
        class="btn btn-outline-secondary btn-sm"
        th:classappend="${page.first} ? 'disabled'"
        th:href="@{/admin/buildings(page=${page.number-1}, size=${page.size}, type=${type}, dynasty=${dynasty})}"
      >
        Prev
      </a>

      <div class="small text-muted">
        Page <span th:text="${page.number + 1}">1</span> /
        <span th:text="${page.totalPages}">1</span>
      </div>

      <a
        class="btn btn-outline-secondary btn-sm"
        th:classappend="${page.last} ? 'disabled'"
        th:href="@{/admin/buildings(page=${page.number+1}, size=${page.size}, type=${type}, dynasty=${dynasty})}"
      >
        Next
      </a>
    </div>
  </section>
</html>
