<!DOCTYPE html>
<html
  lang="en"
  xmlns:th="http://www.thymeleaf.org"
  th:replace="layout/base :: page('Messages', ~{::section})"
>
  <section>
    <div
      class="d-flex flex-wrap align-items-center justify-content-between gap-2"
    >
      <h1 class="h4 mb-0">Messages</h1>
    </div>

    <div class="btn-group mt-3" role="group" aria-label="filter tabs">
      <a
        class="btn btn-outline-dark"
        th:classappend="${isRead == null} ? 'active'"
        th:href="@{/admin/messages}"
        >All</a
      >
      <a
        class="btn btn-outline-dark"
        th:classappend="${isRead != null and isRead == false} ? 'active'"
        th:href="@{/admin/messages(isRead=false)}"
        >Unread</a
      >
      <a
        class="btn btn-outline-dark"
        th:classappend="${isRead != null and isRead == true} ? 'active'"
        th:href="@{/admin/messages(isRead=true)}"
        >Read</a
      >
    </div>

    <div class="bg-white border rounded-4 p-0 mt-3 overflow-hidden">
      <div class="table-responsive">
        <table class="table table-hover align-middle mb-0">
          <thead class="table-light">
            <tr>
              <th style="width: 70px">ID</th>
              <th>From</th>
              <th>Subject</th>
              <th style="width: 110px">Status</th>
              <th style="width: 220px" class="text-end">Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr th:each="m : ${items}">
              <td th:text="${m.id}">1</td>
              <td>
                <div class="fw-semibold" th:text="${m.name}">Name</div>
                <div class="small text-muted" th:text="${m.email}">Email</div>
              </td>
              <td>
                <div
                  class="fw-semibold"
                  th:text="${m.subject} ?: '(No subject)'"
                >
                  (No subject)
                </div>
                <div
                  class="small text-muted"
                  th:text="${#strings.abbreviate(m.message, 110)}"
                ></div>
              </td>
              <td>
                <span
                  class="badge text-bg-light border"
                  th:text="${m.read} ? 'READ' : 'UNREAD'"
                  >UNREAD</span
                >
              </td>
              <td class="text-end">
                <form
                  class="d-inline"
                  th:if="${!m.read}"
                  th:action="@{/admin/messages/{id}/read(id=${m.id})}"
                  method="post"
                >
                  <input
                    type="hidden"
                    th:name="${_csrf.parameterName}"
                    th:value="${_csrf.token}"
                  />
                  <button class="btn btn-sm btn-outline-success">
                    Mark read
                  </button>
                </form>

                <form
                  class="d-inline"
                  th:if="${m.read}"
                  th:action="@{/admin/messages/{id}/unread(id=${m.id})}"
                  method="post"
                >
                  <input
                    type="hidden"
                    th:name="${_csrf.parameterName}"
                    th:value="${_csrf.token}"
                  />
                  <button class="btn btn-sm btn-outline-secondary">
                    Mark unread
                  </button>
                </form>
              </td>
            </tr>

            <tr th:if="${items == null || #lists.isEmpty(items)}">
              <td colspan="5" class="text-center text-muted py-4">
                No messages found.
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </section>
</html>
